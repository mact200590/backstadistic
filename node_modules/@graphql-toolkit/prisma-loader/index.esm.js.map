{"version":3,"file":"index.esm.js","sources":["../../../dist/loaders/prisma/src/index.js"],"sourcesContent":["import { UrlLoader } from '@graphql-toolkit/url-loader';\nimport { PrismaDefinitionClass, Environment } from 'prisma-yml';\nexport class PrismaLoader extends UrlLoader {\n    loaderId() {\n        return 'prisma';\n    }\n    async canLoad(prismaConfigFilePath, options) {\n        if (typeof prismaConfigFilePath === 'string' &&\n            prismaConfigFilePath.endsWith('prisma.yml') &&\n            options.fs &&\n            options.path &&\n            options.os) {\n            const path = options.path || (await import('path'));\n            const joinedYmlPath = path.join(options.cwd || process.cwd(), prismaConfigFilePath);\n            const fs = options.fs.promises;\n            if (!!(await fs.stat(joinedYmlPath).catch((_) => false))) {\n                return true;\n            }\n        }\n        return false;\n    }\n    async load(prismaConfigFilePath, options) {\n        const { graceful, envVars = {}, os = await import('os'), path = await import('path') } = options;\n        const home = os.homedir();\n        const env = new Environment(home);\n        await env.load();\n        const joinedYmlPath = path.join(process.cwd(), prismaConfigFilePath);\n        const definition = new PrismaDefinitionClass(env, joinedYmlPath, envVars);\n        await definition.load({}, undefined, graceful);\n        const serviceName = definition.service;\n        const stage = definition.stage;\n        const clusterName = definition.cluster;\n        if (!clusterName) {\n            throw new Error(`No cluster set. Please set the \"cluster\" property in your prisma.yml`);\n        }\n        const cluster = await definition.getCluster();\n        if (!cluster) {\n            throw new Error(`Cluster ${clusterName} provided in prisma.yml could not be found in global ~/.prisma/config.yml.\n      Please check in ~/.prisma/config.yml, if the cluster exists.\n      You can use \\`docker-compose up -d\\` to start a new cluster.`);\n        }\n        const token = definition.getToken(serviceName, stage);\n        const url = cluster.getApiEndpoint(serviceName, stage, definition.getWorkspace() || undefined);\n        const headers = token\n            ? {\n                Authorization: `Bearer ${token}`,\n            }\n            : undefined;\n        return super.load(url, { headers });\n    }\n}\n//# sourceMappingURL=index.js.map"],"names":[],"mappings":"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"}